{"@timestamp":"2025-01-08T08:35:00.000Z","agent":{"ephemeral_id":"457aa99d-9fdf-4494-9d06-31961a43f33a","id":"9cdf7072-cfc1-4ad5-b68d-b51f0cd9afa8","name":"elastic-agent-21656","type":"metricbeat","version":"8.16.2"},"aws":{"cloudwatch":{"namespace":"AWS/Bedrock/Guardrails"}},"aws_bedrock":{"guardrails":{"invocation_latency":207,"invocations":6,"invocations_intervened":3,"operation":"ApplyGuardrail","text_unit_count":21}},"cloud":{"account":{"id":"11111111111111111","name":"MonitoringAccount"},"provider":"aws","region":"ap-south-1"},"data_stream":{"dataset":"aws_bedrock.guardrails","namespace":"63909","type":"metrics"},"ecs":{"version":"8.0.0"},"elastic_agent":{"id":"9cdf7072-cfc1-4ad5-b68d-b51f0cd9afa8","snapshot":false,"version":"8.16.2"},"event":{"agent_id_status":"verified","dataset":"aws_bedrock.guardrails","duration":100053062,"ingested":"2025-01-08T08:43:11Z","module":"aws"},"host":{"architecture":"x86_64","containerized":true,"hostname":"elastic-agent-21656","ip":["172.26.0.5","172.29.0.2"],"mac":["02-42-AC-1A-00-05","02-42-AC-1D-00-02"],"name":"elastic-agent-21656","os":{"family":"","kernel":"5.4.0-1106-gcp","name":"Wolfi","platform":"wolfi","type":"linux","version":"20230201"}},"metricset":{"name":"cloudwatch","period":300000},"service":{"type":"aws"}}

{"@timestamp":"2024-04-18T22:54:57.000Z","agent":{"ephemeral_id":"d4469df0-eb1e-4d38-8a8a-6151ec12adff","id":"dac9fd53-f482-4758-943d-5d958670ef90","name":"docker-fleet-agent","type":"filebeat","version":"8.13.0"},"aws":{"s3":{"bucket":{"arn":"arn:aws:s3:::elastic-package-aws-logs-bucket-23787","name":"elastic-package-aws-logs-bucket-23787"},"object":{"key":"BedrockModelInvocationLogs"}}},"aws_bedrock":{"invocation":{"input":{"input_body_json":{"anthropic_version":"bedrock-2023-05-31","max_tokens":2000,"messages":[{"content":[{"text":"The following text is from a github issue in the elastic/integrations repository. Please classify what Elastic Fleet integration it is about. This list of can be found at https://docs.elastic.co/integrations/all_integrations. Please indicate it is a bug or enhancement request.\n\n<text>\nThe following processor can turn valid IPv6 address into invalid ones.\n\nhttps://github.com/elastic/integrations/blob/4558683307e3a1a10bd0ff946faf045ed014d135/packages/windows/data_stream/forwarded/elasticsearch/ingest_pipeline/security.yml#L2906-L2910\n\nExamples:\n- `fe80::ffff:ffff:fffe` -> `fe80ffff:fffe`\n- `fe80::ffff:ffff:ffff:ffff` -> `fe80ffff:ffff:ffff`\n\nWhich then later causes errors such as `'fe80ffff:ffff:ffff' is not an IP string literal.` in other processors. It also causes other issues.\n![image](https://github.com/elastic/integrations/assets/1696711/6f189e04-108c-49ec-9c66-ba004c694d57)\n\nI believe this processor's intent is to transform IPs such as `::ffff:192.168.1.1` into `192.168.1.1`. In which case, the pattern should be `^::ffff:` to anchor the pattern at the beginning of the string.\n\n```\n  - gsub:\n      field: source.ip\n      pattern: \"^::ffff:\"\n      replacement: \"\"\n      ignore_missing: true\n```\n\nI tested this in a simulated pipeline using both `fe80::ffff:ffff:fffe` and `::ffff:192.168.1.1` values. It correctly left the former untouched and correctly stripped the prefix from the latter.\n\nReferences:\n- [RFC 5156 Section 2.2](https://www.rfc-editor.org/rfc/rfc5156.html#section-2.2)\n- [RFC 4291 Section 2.2](https://www.rfc-editor.org/rfc/rfc4291#section-2.2)\n- https://www.ibm.com/docs/en/i/7.5?topic=concepts-ipv6-address-formats\n</text>","type":"text"}],"role":"user"}],"stop_sequences":["\n\nHuman:"],"temperature":1,"top_k":250,"top_p":0.999},"input_content_type":"application/json","input_token_count":571},"model_id":"anthropic.claude-3-haiku-20240307-v1:0","output":{"output_body_json":[{"message":{"id":"msg_01L3WcyJkxCgmHpMiLRhSYvf","model":"claude-3-haiku-48k-20240307","role":"assistant","type":"message","usage":{"input_tokens":571,"output_tokens":1}},"type":"message_start"},{"content_block":{"type":"text"},"index":0,"type":"content_block_start"},{"delta":{"text":"The","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" text","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" provided","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" is","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" about","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" a","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" bug","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" in","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" the","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" Elastic","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" Fleet's","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" Windows","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" data","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" stream","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" forw","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":"arded","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" integration.","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" Specifically,","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" the","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" text","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" discusses","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" an","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" issue","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" with","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" the","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" `security.yml`","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" ingest","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" pipeline","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" that","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" can","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" turn","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" valid","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" IPv6","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" addresses","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" into","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" invalid","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" ones.","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":"\n\nThe","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" bug","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" occurs","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" in","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" the","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" following","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":" code:","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":"\n\n```yaml\n- gsub:\n    field: source.ip\n    pattern: \"::ffff:(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\"\n    replacement: \"\\1\"\n    ignore_missing: true\n```\n\nThe issue is that the pattern `::ffff:(\\d+\\.\\d+\\.\\d+\\.\\d+)` is not anchored at the beginning of the string, which can lead to unintended transformations of valid IPv6 addresses.\n\nThe text suggests a fix by using the pattern `^::ffff:` to anchor the pattern at the beginning of the string, which would correctly transform `::ffff:192.168.1.1` into `192.168.1.1` while leaving `fe80::ffff:ffff:fffe` untouched.\n\nIn summary, this is a bug report for the Elastic Fleet's Windows data stream forwarded integration.","type":"text_delta"},"index":0,"type":"content_block_delta"},{"delta":{"text":".", "type":"text_delta"},"index":0,"type":"content_block_delta"},{"type":"content_block_stop","index":0},{"type":"message_stop"}]}}}}

{"@timestamp":"2024-07-15T07:35:00.000Z","agent":{"ephemeral_id":"63673811-d18c-4209-8818-df8b346bcb28","id":"47a2173f-3f59-4a7c-a022-dee86802c2c1","name":"service-integration-dev-idc-1","type":"metricbeat","version":"8.13.4"},"aws":{"cloudwatch":{"namespace":"AWS/Bedrock"}},"aws_bedrock":{"runtime":{"input_token_count":848,"invocation_latency":2757,"invocations":5,"output_token_count":1775}},"cloud":{"account":{"id":"00000000000000","name":"MonitoringAccount"},"provider":"aws","region":"ap-south-1"},"data_stream":{"dataset":"aws_bedrock.runtime","namespace":"ep","type":"metrics"},"ecs":{"version":"8.0.0"},"elastic_agent":{"id":"47a2173f-3f59-4a7c-a022-dee86802c2c1","snapshot":false,"version":"8.13.4"},"event":{"agent_id_status":"verified","dataset":"aws_bedrock.runtime","duration":174434808,"ingested":"2024-07-15T07:44:02Z","module":"aws"},"host":{"architecture":"x86_64","containerized":false,"hostname":"service-integration-dev-idc-1","id":"1bfc9b2d8959f75a520a3cb94cf035c8","ip":["10.160.0.4","172.1.0.1","172.17.0.1","172.19.0.1","172.20.0.1","172.22.0.1","172.23.0.1","172.26.0.1","172.27.0.1","172.28.0.1","172.29.0.1","172.30.0.1","172.31.0.1","192.168.0.1","192.168.32.1","192.168.49.1","192.168.80.1","192.168.224.1","fe80::42:9cff:fe5b:79b4","fe80::42:a5ff:fe15:d63c","fe80::42:beff:fe39:f457","fe80::42a:f7ff:fe6c:421d","fe80::1818:53ff:fea8:3f38","fe80::4001:aff:fea0:4","fe80::8cfa:3aff:fedb:656a","fe80::c890:29ff:fe99:ac1b","fe80::fcfc:c2ff:feca:1e28"],"mac":["02-42-0D-A6-43-C0","02-42-23-32-CF-25","02-42-27-90-E6-54","02-42-34-10-CA-62","02-42-4F-1D-94-1B","02-42-50-2E-CB-58","02-42-5D-42-F3-1D","02-42-66-9B-25-B2","02-42-99-B7-1B-26","02-42-9C-5B-79-B4","02-42-A5-15-D6-3C","02-42-A6-68-F8-E9","02-42-BE-39-F4-57","02-42-CE-31-B7-A3","02-42-E8-F3-CF-7A","02-42-F1-35-B0-41","02-42-F4-2F-0F-22","06-2A-F7-6C-42-1D","1A-18-53-A8-3F-38","42-01-0A-A0-00-04","8E-FA-3A-DB-65-6A","CA-90-29-99-AC-1B","FE-FC-C2-CA-1E-28"],"name":"service-integration-dev-idc-1","os":{"codename":"bionic","family":"debian","kernel":"5.4.0-1106-gcp","name":"Ubuntu","platform":"ubuntu","type":"linux","version":"18.04.6 LTS (Bionic Beaver)"}},"metricset":{"name":"cloudwatch","period":300000},"service":{"type":"aws"}}

